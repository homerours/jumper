#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

static const char bash_variables[] =
    "[[ -n $__JUMPER_FLAGS ]] || __JUMPER_FLAGS='-cHo -n 500'\n"
    "[[ -n $__JUMPER_ZFLAGS ]] || __JUMPER_ZFLAGS='-o'\n"
    "[[ -n $__JUMPER_FZF_OPTS ]] || __JUMPER_FZF_OPTS='--height=70%% "
    "--layout=reverse --keep-right --info=hidden --preview-window=hidden "
    "--ansi'\n"
    "if [[ -z $__JUMPER_FZF_FILES_PREVIEW ]]; then\n"
    "  if command -v bat >/dev/null 2>&1; then\n"
    "    __JUMPER_FZF_FILES_PREVIEW='bat --color=always'\n"
    "  else\n"
    "    __JUMPER_FZF_FILES_PREVIEW='cat'\n"
    "  fi\n"
    "fi\n"
    "[[ -n $__JUMPER_FZF_FOLDERS_PREVIEW ]] || "
    "__JUMPER_FZF_FOLDERS_PREVIEW='ls -1UpC --color=always'\n"
    "[[ -n $__JUMPER_TOGGLE_PREVIEW ]] || __JUMPER_TOGGLE_PREVIEW='ctrl-p'\n"
    "__fzf_version=$(fzf --version 2>/dev/null || echo '0.0.0')\n"
    "__fzf_version=${__fzf_version%%%% *}\n"
    "__fzf_major=${__fzf_version%%%%.*}\n"
    "__fzf_minor=${__fzf_version#*.}\n"
    "__fzf_minor=${__fzf_minor%%%%.*}\n"
    "if [[ $__fzf_major -gt 0 || $__fzf_minor -ge 45 ]]; then\n"
    "  export __JUMPER_HAS_FZF_PROMPT=1\n"
    "else\n"
    "  export __JUMPER_HAS_FZF_PROMPT=0\n"
    "fi\n";

static const char bash_functions[] =
    "z() {\n"
    "  if [[ $# -eq 0 ]]; then\n"
    "    cd\n"
    "    return 0\n"
    "  fi\n"
    "  args=\"${@// /\\ }\"\n"
    "  new_path=$(jumper find --type=directories ${__JUMPER_ZFLAGS} -n 1 "
    "\"${args}\")\n"
    "  if [[ -z $new_path ]]; then\n"
    "    echo 'No match found.'\n"
    "  else\n"
    "    cd \"${new_path}\"\n"
    "  fi\n"
    "}\n"
    "zf() {\n"
    "  args=\"${@// /\\ }\"\n"
    "  file=$(jumper find --type=files ${__JUMPER_ZFLAGS} -n 1 \"${args}\")\n"
    "  if [[ -z $file ]]; then\n"
    "    echo 'No match found.'\n"
    "    else\n"
    "    $EDITOR \"${file}\"\n"
    "  fi\n"
    "}\n"
    "__jumper_fzf() {\n"
    "  if [[ $1 == 'directories' ]]; then\n"
    "    preview=\"${__JUMPER_FZF_FOLDERS_PREVIEW}\"\n"
    "  else\n"
    "    preview=\"${__JUMPER_FZF_FILES_PREVIEW}\"\n"
    "  fi\n"
    "  if [[ $__JUMPER_HAS_FZF_PROMPT == 1 ]]; then\n"
    "    selected=$(fzf ${__JUMPER_FZF_OPTS} --disabled --query \"$2\" \\\n"
    "      --prompt \"$1> \" \\\n"
    "      --preview \"eval x={}; ${preview} \\$x\" \\\n"
    "      --bind \"${__JUMPER_TOGGLE_PREVIEW}:toggle-preview\" \\\n"
    "      --bind \"start:reload:jumper find --type=${1:0:1} ${__JUMPER_FLAGS} {q}\" \\\n"
    "      --bind \"change:reload:sleep 0.01; p={fzf:prompt}; jumper find --type=\\${p:0:1} ${__JUMPER_FLAGS} {q} || true\" \\\n"
    "      --bind \"ctrl-u:change-prompt(files> )+reload(jumper find --type=f ${__JUMPER_FLAGS} {q})\" \\\n"
    "      --bind \"ctrl-y:change-prompt(directories> )+reload(jumper find --type=d ${__JUMPER_FLAGS} {q})\" \\\n"
    "      --bind \"enter:become(echo {fzf:prompt}{})\")\n"
    "  else\n"
    "    selected=$(fzf ${__JUMPER_FZF_OPTS} --disabled --query \"$2\" \\\n"
    "      --prompt \"$1> \" \\\n"
    "      --preview \"eval x={}; ${preview} \\$x\" \\\n"
    "      --bind \"${__JUMPER_TOGGLE_PREVIEW}:toggle-preview\" \\\n"
    "      --bind \"start:reload:jumper find --type=${1:0:1} ${__JUMPER_FLAGS} {q}\" \\\n"
    "      --bind \"change:reload:sleep 0.01; jumper find --type=${1:0:1} ${__JUMPER_FLAGS} {q} || true\")\n"
    "  fi\n"
    "  actual_selection=\"\"\n"
    "  if [[ -n $selected ]]; then\n"
    "    if [[ $__JUMPER_HAS_FZF_PROMPT == 1 ]]; then\n"
    "      if [[ $selected == \"files> \"* ]]; then\n"
    "        actual_type=\"files\"\n"
    "        actual_selection=\"${selected#files> }\"\n"
    "      elif [[ $selected == \"directories> \"* ]]; then\n"
    "        actual_type=\"directories\"\n"
    "        actual_selection=\"${selected#directories> }\"\n"
    "      fi\n"
    "    else\n"
    "      actual_selection=\"$selected\"\n"
    "      actual_type=\"$1\"\n"
    "    fi\n"
    "    if [[ -n $actual_selection ]]; then\n"
    "      expanded=\"${actual_selection/#\\~/$HOME}\"\n"
    "      jumper update --type=\"$actual_type\" -w 0.3 \"$expanded\"\n"
    "    fi\n"
    "  fi\n"
    "  echo \"$actual_selection\"\n"
    "}\n"
    "zi() {\n"
    "  args=\"${@// /\\ }\"\n"
    "  new_path=$(__jumper_fzf 'directories' \"$args\")\n"
    "  if [[ -n $new_path ]]; then\n"
    "    cd \"${new_path/#\\~/$HOME}\"\n"
    "  fi\n"
    "}\n"
    "zfi() {\n"
    "  args=\"${@// /\\ }\"\n"
    "  file=$(__jumper_fzf 'files' \"$args\")\n"
    "  if [[ -n $file ]]; then\n"
    "    $EDITOR \"${file/#\\~/$HOME}\"\n"
    "  fi\n"
    "}\n"
    "__jumper_delete_duplicate_symlinks(){\n"
    "  tempfile=\"${__JUMPER_FOLDERS}_temp\"\n"
    "  cp \"${__JUMPER_FOLDERS}\" \"${tempfile}\"\n"
    "  while IFS= read -r line ; do\n"
    "    entry=\"${line%%%%|*}\"\n"
    "    real=$(realpath \"$entry\")\n"
    "    if [[ $entry != $real ]]; then\n"
    "      sed -i -e \"\\:^${real}|:d\" \"${tempfile}\"\n"
    "    fi\n"
    "  done < \"${__JUMPER_FOLDERS}\"\n"
    "  mv \"${tempfile}\" \"${__JUMPER_FOLDERS}\"\n"
    "}\n"
    "__jumper_replace_symlinks(){\n"
    "  tempfile=\"${__JUMPER_FOLDERS}_temp\"\n"
    "  cp \"${__JUMPER_FOLDERS}\" \"${tempfile}\"\n"
    "  while IFS= read -r line ; do\n"
    "    entry=\"${line%%%%|*}\"\n"
    "    real=$(realpath \"$entry\")\n"
    "    if [[ $entry != $real ]]; then\n"
    "      sed -i -e \"s:^${real}/:${entry}/:g\" \"${tempfile}\"\n"
    "    fi\n"
    "  done < \"${__JUMPER_FOLDERS}\"\n"
    "  mv \"${tempfile}\" \"${__JUMPER_FOLDERS}\"\n"
    "}\n"
    "__jumper_clean_symlinks(){\n"
    "  __jumper_delete_duplicate_symlinks\n"
    "  __jumper_replace_symlinks\n"
    "}\n"
    "__jumper_update_db() {\n"
    "  if [[ -n $__jumper_current_folder ]]; then\n"
    "    if [[ $__jumper_current_folder != $PWD ]]; then\n"
    "      jumper update --type=directories -w 1.0 \"$PWD\"\n"
    "    else\n"
    "      jumper update --type=directories -w 0.3 \"$PWD\"\n"
    "    fi\n"
    "  fi\n"
    "  __jumper_current_folder=$PWD\n"
    "  if [[ -n $__JUMPER_CLEAN_FREQ ]] && [[ $(( RANDOM %% "
    "__JUMPER_CLEAN_FREQ )) == 0 ]]; then\n"
    "    jumper clean > /dev/null 2>&1\n"
    "  fi\n"
    "}\n"
    "jumper-find-dir() {\n"
    "  selected=$(__jumper_fzf 'directories')\n"
    "  pre=\"${READLINE_LINE:0:$READLINE_POINT}\"\n"
    "  READLINE_LINE=\"${pre}$selected${READLINE_LINE:$READLINE_POINT}\"\n"
    "  READLINE_POINT=$(( READLINE_POINT + ${#selected} ))\n"
    "}\n"
    "jumper-find-file() {\n"
    "  selected=$(__jumper_fzf 'files')\n"
    "  pre=\"${READLINE_LINE:0:$READLINE_POINT}\"\n"
    "  READLINE_LINE=\"${pre}$selected${READLINE_LINE:$READLINE_POINT}\"\n"
    "  READLINE_POINT=$(( READLINE_POINT + ${#selected} ))\n"
    "}\n";

static const char bash_completions[] =
    "_z_completion() {\n"
    "  local cur=\"${COMP_WORDS[COMP_CWORD]}\"\n"
    "  local IFS=$'\\n'\n"
    "  local results=($(jumper find --type=directories ${__JUMPER_ZFLAGS} -n 3 \"$cur\" 2>/dev/null))\n"
    "  COMPREPLY=(\"${results[@]}\")\n"
    "}\n"
    "_zf_completion() {\n"
    "  local cur=\"${COMP_WORDS[COMP_CWORD]}\"\n"
    "  local IFS=$'\\n'\n"
    "  local results=($(jumper find --type=files ${__JUMPER_ZFLAGS} -n 3 \"$cur\" 2>/dev/null))\n"
    "  COMPREPLY=(\"${results[@]}\")\n"
    "}\n"
    "complete -o nosort -o nospace -F _z_completion z\n"
    "complete -o nosort -o nospace -F _zf_completion zf\n";

static const char bash_bindings[] =
    "bind -x '\"\\C-y\": jumper-find-dir'\n"
    "stty kill undef\n"
    "bind -x '\"\\C-u\": jumper-find-file'\n";

static const char bash_prompt[] =
    "PROMPT_COMMAND=\"__jumper_update_db;$PROMPT_COMMAND\"\n";

static const char zsh_variables[] =
    "[[ -n $__JUMPER_FLAGS ]] || __JUMPER_FLAGS='-cHo -n 500'\n"
    "[[ -n $__JUMPER_ZFLAGS ]] || __JUMPER_ZFLAGS='-o'\n"
    "[[ -n $__JUMPER_FZF_OPTS ]] || __JUMPER_FZF_OPTS=(--height=70%% "
    "--layout=reverse --keep-right --info=hidden --preview-window=hidden "
    "--ansi)\n"
    "if [[ -z $__JUMPER_FZF_FILES_PREVIEW ]]; then\n"
    "  if command -v bat >/dev/null 2>&1; then\n"
    "    __JUMPER_FZF_FILES_PREVIEW='bat --color=always'\n"
    "  else\n"
    "    __JUMPER_FZF_FILES_PREVIEW='cat'\n"
    "  fi\n"
    "fi\n"
    "[[ -n $__JUMPER_FZF_FOLDERS_PREVIEW ]] || "
    "__JUMPER_FZF_FOLDERS_PREVIEW='ls -1UpC --color=always'\n"
    "[[ -n $__JUMPER_TOGGLE_PREVIEW ]] || __JUMPER_TOGGLE_PREVIEW='ctrl-p'\n"
    "__fzf_version=$(fzf --version 2>/dev/null || echo '0.0.0')\n"
    "__fzf_version=${__fzf_version%%%% *}\n"
    "__fzf_major=${__fzf_version%%%%.*}\n"
    "__fzf_minor=${__fzf_version#*.}\n"
    "__fzf_minor=${__fzf_minor%%%%.*}\n"
    "if [[ $__fzf_major -gt 0 || $__fzf_minor -ge 45 ]]; then\n"
    "  export __JUMPER_HAS_FZF_PROMPT=1\n"
    "else\n"
    "  export __JUMPER_HAS_FZF_PROMPT=0\n"
    "fi\n";

static const char zsh_functions[] =
    "z() {\n"
    "  if [[ $# -eq 0 ]]; then\n"
    "    cd\n"
    "    return 0\n"
    "  fi\n"
    "  args=\"${@// /\\ }\"\n"
    "  new_path=$(jumper find --type=directories ${__JUMPER_ZFLAGS} -n 1 "
    "\"${args}\")\n"
    "  if [[ -z $new_path ]]; then\n"
    "    echo 'No match found.'\n"
    "  else\n"
    "    cd \"${new_path}\"\n"
    "  fi\n"
    "}\n"
    "zf() {\n"
    "  args=\"${@// /\\ }\"\n"
    "  file=$(jumper find --type=files ${__JUMPER_ZFLAGS} -n 1 \"${args}\")\n"
    "  if [[ -z $file ]]; then\n"
    "    echo 'No match found.'\n"
    "  else\n"
    "    $EDITOR \"${file}\"\n"
    "  fi\n"
    "}\n"
    "__jumper_fzf() {\n"
    "  if [[ $1 == 'directories' ]]; then\n"
    "    preview=\"${__JUMPER_FZF_FOLDERS_PREVIEW}\"\n"
    "  else\n"
    "    preview=\"${__JUMPER_FZF_FILES_PREVIEW}\"\n"
    "  fi\n"
    "  if [[ $__JUMPER_HAS_FZF_PROMPT == 1 ]]; then\n"
    "    selected=$(fzf ${__JUMPER_FZF_OPTS} --disabled --query \"$2\" \\\n"
    "      --prompt \"$1> \" \\\n"
    "      --preview \"eval x={}; ${preview} \\$x\" \\\n"
    "      --bind \"${__JUMPER_TOGGLE_PREVIEW}:toggle-preview\" \\\n"
    "      --bind \"start:reload:jumper find --type=${1:0:1} ${__JUMPER_FLAGS} {q}\" \\\n"
    "      --bind \"change:reload:sleep 0.01; p={fzf:prompt}; jumper find --type=\\${p:0:1} ${__JUMPER_FLAGS} {q} || true\" \\\n"
    "      --bind \"ctrl-u:change-prompt(files> )+reload(jumper find --type=f ${__JUMPER_FLAGS} {q})\" \\\n"
    "      --bind \"ctrl-y:change-prompt(directories> )+reload(jumper find --type=d ${__JUMPER_FLAGS} {q})\" \\\n"
    "      --bind \"enter:become(echo {fzf:prompt}{})\")\n"
    "  else\n"
    "    selected=$(fzf ${__JUMPER_FZF_OPTS} --disabled --query \"$2\" \\\n"
    "      --prompt \"$1> \" \\\n"
    "      --preview \"eval x={}; ${preview} \\$x\" \\\n"
    "      --bind \"${__JUMPER_TOGGLE_PREVIEW}:toggle-preview\" \\\n"
    "      --bind \"start:reload:jumper find --type=${1:0:1} ${__JUMPER_FLAGS} {q}\" \\\n"
    "      --bind \"change:reload:sleep 0.01; jumper find --type=${1:0:1} ${__JUMPER_FLAGS} {q} || true\")\n"
    "  fi\n"
    "  actual_selection=\"\"\n"
    "  if [[ -n $selected ]]; then\n"
    "    if [[ $__JUMPER_HAS_FZF_PROMPT == 1 ]]; then\n"
    "      if [[ $selected == \"files> \"* ]]; then\n"
    "        actual_type=\"files\"\n"
    "        actual_selection=\"${selected#files> }\"\n"
    "      elif [[ $selected == \"directories> \"* ]]; then\n"
    "        actual_type=\"directories\"\n"
    "        actual_selection=\"${selected#directories> }\"\n"
    "      fi\n"
    "    else\n"
    "      actual_selection=\"$selected\"\n"
    "      actual_type=\"$1\"\n"
    "    fi\n"
    "    if [[ -n $actual_selection ]]; then\n"
    "      expanded=\"${actual_selection/#\\~/$HOME}\"\n"
    "      jumper update --type=\"$actual_type\" -w 0.3 \"$expanded\"\n"
    "    fi\n"
    "  fi\n"
    "  echo $actual_selection\n"
    "}\n"
    "zi() {\n"
    "  args=\"${@// /\\ }\"\n"
    "  new_path=$(__jumper_fzf 'directories' \"$args\")\n"
    "  if [[ -n $new_path ]]; then\n"
    "    # Manually perform tilde expansion\n"
    "    cd \"${new_path/#\\~/$HOME}\"\n"
    "  fi\n"
    "}\n"
    "zfi() {\n"
    "  args=\"${@// /\\ }\"\n"
    "  file=$(__jumper_fzf 'files' \"$args\")\n"
    "  if [[ -n $file ]]; then\n"
    "    # Manually perform tilde expansion\n"
    "    $EDITOR \"${file/#\\~/$HOME}\"\n"
    "  fi\n"
    "}\n"
    "__jumper_delete_duplicate_symlinks(){\n"
    "  tempfile=\"${__JUMPER_FOLDERS}_temp\"\n"
    "  cp \"${__JUMPER_FOLDERS}\" \"${tempfile}\"\n"
    "  while IFS= read -r line ; do\n"
    "    entry=\"${line%%%%|*}\"\n"
    "    real=$(realpath \"$entry\")\n"
    "    if [[ $entry != $real ]]; then\n"
    "      sed -i -e \"\\:^${real}|:d\" \"${tempfile}\"\n"
    "    fi\n"
    "  done < \"${__JUMPER_FOLDERS}\"\n"
    "  mv \"${tempfile}\" \"${__JUMPER_FOLDERS}\"\n"
    "}\n"
    "__jumper_replace_symlinks(){\n"
    "  tempfile=\"${__JUMPER_FOLDERS}_temp\"\n"
    "  cp \"${__JUMPER_FOLDERS}\" \"${tempfile}\"\n"
    "  while IFS= read -r line ; do\n"
    "    entry=\"${line%%%%|*}\"\n"
    "    real=$(realpath \"$entry\")\n"
    "    if [[ $entry != $real ]]; then\n"
    "      sed -i -e \"s:^${real}/:${entry}/:g\" \"${tempfile}\"\n"
    "    fi\n"
    "  done < \"${__JUMPER_FOLDERS}\"\n"
    "  mv \"${tempfile}\" \"${__JUMPER_FOLDERS}\"\n"
    "}\n"
    "__jumper_clean_symlinks(){\n"
    "  __jumper_delete_duplicate_symlinks\n"
    "  __jumper_replace_symlinks\n"
    "}\n"
    "__jumper_update_db() {\n"
    "  if [[ ! -z $__jumper_current_folder ]]; then\n"
    "    if [[ $__jumper_current_folder != $PWD ]]; then\n"
    "      # working directory has changed, this visit has more weight\n"
    "      jumper update --type=directories -w 1.0 \"$PWD\"\n"
    "    else\n"
    "      # working directory has not changed\n"
    "      jumper update --type=directories -w 0.3 \"$PWD\"\n"
    "    fi\n"
    "  fi\n"
    "  __jumper_current_folder=$PWD\n"
    "  # Remove files and folders that do not exist anymore\n"
    "  if [[ -n $__JUMPER_CLEAN_FREQ ]] && [[ $(( RANDOM %% "
    "__JUMPER_CLEAN_FREQ )) == 0 ]]; then\n"
    "    jumper clean > /dev/null 2>&1\n"
    "  fi\n"
    "}\n"
    "jumper-find-dir() {\n"
    "  selected=$(__jumper_fzf 'directories')\n"
    "  LBUFFER=\"${LBUFFER}${selected}\"\n"
    "  zle reset-prompt\n"
    "}\n"
    "jumper-find-file() {\n"
    "  selected=$(__jumper_fzf 'files')\n"
    "  LBUFFER=\"${LBUFFER}${selected}\"\n"
    "  zle reset-prompt\n"
    "}\n";

static const char zsh_completions[] =
    "if ! type compdef >/dev/null 2>&1; then\n"
    "  autoload -Uz compinit\n"
    "  compinit -C\n"
    "fi\n"
    "zstyle ':completion:*:*:z:*' menu yes select\n"
    "zstyle ':completion:*:*:zf:*' menu yes select\n"
    "zstyle ':completion:*:*:z:*' insert-unambiguous false\n"
    "zstyle ':completion:*:*:zf:*' insert-unambiguous false\n"
    "zstyle ':completion:*:*:z:*' original true\n"
    "zstyle ':completion:*:*:zf:*' original true\n"
    "_z_completion() {\n"
    "  setopt localoptions menu_complete no_list_beep; unsetopt list_ambiguous bash_auto_list auto_list; compstate[insert]=menu; compstate[list]=list\n"
    "  compadd -Q -U -V unsorted -- ${(f)\"$(jumper find --type=directories ${__JUMPER_ZFLAGS} -n 3 \"${words[CURRENT]:-${words[2,-1]}}\" 2>/dev/null)\"}\n"
    "}\n"
    "_zf_completion() {\n"
    "  setopt localoptions menu_complete no_list_beep; unsetopt list_ambiguous bash_auto_list auto_list; compstate[insert]=menu; compstate[list]=list\n"
    "  compadd -Q -U -V unsorted -- ${(f)\"$(jumper find --type=files ${__JUMPER_ZFLAGS} -n 3 \"${words[CURRENT]:-${words[2,-1]}}\" 2>/dev/null)\"}\n"
    "}\n"
    "compdef _z_completion z\n"
    "compdef _zf_completion zf\n";

static const char zsh_bindings[] = "zle -N jumper-find-dir\n"
                                   "zle -N jumper-find-file\n"
                                   "bindkey '^Y' jumper-find-dir\n"
                                   "bindkey '^U' jumper-find-file\n";

static const char zsh_prompt[] =
    "precmd_functions+=(__jumper_update_db)\n";

static const char fish_variables[] =
    "if not set -q __JUMPER_FLAGS\n"
    "  set __JUMPER_FLAGS '-cHo -n 500'\n"
    "end\n"
    "if not set -q __JUMPER_ZFLAGS\n"
    "  set __JUMPER_ZFLAGS '-o'\n"
    "end\n"
    "if not set -q __JUMPER_FZF_OPTS\n"
    "  set __JUMPER_FZF_OPTS --info=hidden --height=70%% --layout=reverse "
    "--keep-right "
    "--preview-window=hidden --ansi\n"
    "end\n"
    "if not set -q __JUMPER_FZF_FILES_PREVIEW\n"
    "  if type -q bat\n"
    "    set __JUMPER_FZF_FILES_PREVIEW 'bat --color=always'\n"
    "  else\n"
    "    set __JUMPER_FZF_FILES_PREVIEW 'cat'\n"
    "  end\n"
    "end\n"
    "if not set -q __JUMPER_FZF_FOLDERS_PREVIEW\n"
    "  set __JUMPER_FZF_FOLDERS_PREVIEW 'ls -1UpC --color=always'\n"
    "end\n"
    "if not set -q __JUMPER_TOGGLE_PREVIEW\n"
    "  set __JUMPER_TOGGLE_PREVIEW 'ctrl-p'\n"
    "end\n"
    "set __fzf_version (fzf --version 2>/dev/null; or echo '0.0.0')\n"
    "set __fzf_version (string split ' ' $__fzf_version)[1]\n"
    "set __fzf_parts (string split '.' $__fzf_version)\n"
    "if test $__fzf_parts[1] -gt 0; or test $__fzf_parts[2] -ge 45\n"
    "  set -gx __JUMPER_HAS_FZF_PROMPT 1\n"
    "else\n"
    "  set -gx __JUMPER_HAS_FZF_PROMPT 0\n"
    "end\n";

static const char fish_functions[] =
    "function jumper_update_db --on-event fish_postexec\n"
    "  if set -q __jumper_current_folder\n"
    "    if [ $__jumper_current_folder != $PWD ]\n"
    "      # working directory has changed, this visit has more weight\n"
    "      jumper update --type=directories -w 1.0 \"$PWD\"\n"
    "    else\n"
    "      # working directory has not changed\n"
    "      jumper update --type=directories -w 0.3 \"$PWD\"\n"
    "    end\n"
    "  end\n"
    "  set -g __jumper_current_folder \"$PWD\"\n"
    "  if [ -n \"$__JUMPER_CLEAN_FREQ\" ] && [ (math (random) %% "
    "$__JUMPER_CLEAN_FREQ) -eq 0 ]\n"
    "    jumper clean > /dev/null 2>&1\n"
    "  end\n"
    "end\n"
    "function z -d \"Jump to folder\"\n"
    "  if not count $argv > /dev/null\n"
    "    cd\n"
    "    return 0\n"
    "  end\n"
    "  set -l new_path (jumper find --type=directories $__JUMPER_ZFLAGS -n 1 "
    "\"$argv\")\n"
    "  if [ -n \"$new_path\" ]\n"
    "    cd \"$new_path\"\n"
    "  else\n"
    "    echo 'No match found'\n"
    "  end\n"
    "end\n"
    "function zf -d \"Jump to file\"\n"
    "  set -l file (jumper find --type=files $__JUMPER_ZFLAGS -n 1 "
    "\"$argv\")\n"
    "  if [ -n \"$file\" ]\n"
    "    $EDITOR \"$file\"\n"
    "  else\n"
    "    echo 'No match found'\n"
    "  end\n"
    "end\n"
    "function __jumper_fzf -d \"run fzf on jumper's directories\"\n"
    "  if [ $argv[1] = 'files' ]\n"
    "    set -l preview $__JUMPER_FZF_FILES_PREVIEW\n"
    "  else\n"
    "    set -l preview $__JUMPER_FZF_FOLDERS_PREVIEW\n"
    "  end\n"
    "  set -l type_char (string sub -l 1 $argv[1])\n"
    "  if test $__JUMPER_HAS_FZF_PROMPT -eq 1\n"
    "    set selected (fzf $__JUMPER_FZF_OPTS --disabled --query \"$argv[2]\" "
    "\\\n"
    "        --prompt \"$argv[1]> \" \\\n"
    "        --preview \"eval set -l x {}; $preview \\$x\" \\\n"
    "        --bind \"$__JUMPER_TOGGLE_PREVIEW:toggle-preview\" \\\n"
    "        --bind \"start:reload:jumper find --type=$type_char $__JUMPER_FLAGS {q}\" \\\n"
    "        --bind \"change:reload:sleep 0.01; p={fzf:prompt}; t=\\${p:0:1}; jumper find --type=\\$t $__JUMPER_FLAGS {q} || true\" \\\n"
    "        --bind \"ctrl-u:change-prompt(files> )+reload(jumper find --type=f $__JUMPER_FLAGS {q})\" \\\n"
    "        --bind \"ctrl-y:change-prompt(directories> )+reload(jumper find --type=d $__JUMPER_FLAGS {q})\" \\\n"
    "        --bind \"enter:become(echo {fzf:prompt}{})\")\n"
    "  else\n"
    "    set selected (fzf $__JUMPER_FZF_OPTS --disabled --query \"$argv[2]\" "
    "\\\n"
    "        --prompt \"$argv[1]> \" \\\n"
    "        --preview \"eval set -l x {}; $preview \\$x\" \\\n"
    "        --bind \"$__JUMPER_TOGGLE_PREVIEW:toggle-preview\" \\\n"
    "        --bind \"start:reload:jumper find --type=$type_char $__JUMPER_FLAGS {q}\" \\\n"
    "        --bind \"change:reload:sleep 0.01; jumper find --type=$type_char $__JUMPER_FLAGS {q} || true\")\n"
    "  end\n"
    "  set actual_selection ''\n"
    "  if [ -n \"$selected\" ]\n"
    "    if test $__JUMPER_HAS_FZF_PROMPT -eq 1\n"
    "      if string match -q 'files> *' $selected\n"
    "        set actual_type files\n"
    "        set actual_selection (string replace 'files> ' '' $selected)\n"
    "      else if string match -q 'directories> *' $selected\n"
    "        set actual_type directories\n"
    "        set actual_selection (string replace 'directories> ' '' $selected)\n"
    "      end\n"
    "    else\n"
    "      set actual_selection $selected\n"
    "      set actual_type $argv[1]\n"
    "    end\n"
    "    if [ -n \"$actual_selection\" ]\n"
    "      set new_path (string replace '~' $HOME $actual_selection)\n"
    "      jumper update --type=$actual_type -w 0.3 \"$new_path\"\n"
    "    end\n"
    "  end\n"
    "  echo $actual_selection\n"
    "end\n"
    "function zi -d \"Interactive jump to folder\"\n"
    "  set new_path (__jumper_fzf 'directories' \"$argv\")\n"
    "  if [ -n \"$new_path\" ]\n"
    "    set new_path (string replace '~' $HOME $new_path)\n"
    "    cd \"$new_path\"\n"
    "  end\n"
    "end\n"
    "function zfi -d \"Interactive jump to file\"\n"
    "  set file (__jumper_fzf 'files' \"$argv\")\n"
    "  if [ -n \"$file\" ]\n"
    "    set file (string replace '~' $HOME $file)\n"
    "    $EDITOR \"$file\"\n"
    "  end\n"
    "end\n"
    "function jumper-find-dir -d \"Fuzzy-find directories\"\n"
    "  set -l commandline (commandline -t)\n"
    "  set result (__jumper_fzf 'directories')\n"
    "  if [ -n \"$result\" ]\n"
    "    commandline -it -- $result\n"
    "  end\n"
    "  commandline -f repaint\n"
    "end\n"
    "function jumper-find-file -d \"Fuzzy-find files\"\n"
    "  set -l commandline (commandline -t)\n"
    "  set result (__jumper_fzf 'files')\n"
    "  if [ -n \"$result\" ]\n"
    "      commandline -it -- $result\n"
    "  end\n"
    "  commandline -f repaint\n"
    "end\n";

static const char fish_bindings[] = "bind \\cy jumper-find-dir\n"
                                    "bind \\cu jumper-find-file\n";

void shell_setup(const char *shell, bool no_bind) {
  if (strcmp(shell, "bash") == 0) {
    printf(bash_variables);
    printf(bash_functions);
    printf(bash_completions);
    if (!no_bind) printf(bash_bindings);
    printf(bash_prompt);
  } else if (strcmp(shell, "zsh") == 0) {
    printf(zsh_variables);
    printf(zsh_functions);
    printf(zsh_completions);
    if (!no_bind) printf(zsh_bindings);
    printf(zsh_prompt);
  } else if (strcmp(shell, "fish") == 0) {
    printf(fish_variables);
    printf(fish_functions);
    if (!no_bind) printf(fish_bindings);
  } else {
    fprintf(stderr, "ERROR: Invalid argument for shell: %s.\n", shell);
    fprintf(stderr, "Accepted arguments: bash, zsh, fish.\n");
    exit(EXIT_FAILURE);
  }
}
